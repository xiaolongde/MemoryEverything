# MemoryEverything - AI 深度解读功能开发

> 开发时间：2026-02-09
> 目标：从流水账式记录升级为智能知识管理系统

## 📋 背景与需求

### 用户痛点
用户会将好的文章、短视频转发到微信文件传输助手，但随着内容越来越多，流水账式的记录已经不能满足需求：

1. ✅ **分门别类整理** - 已通过 AI 自动分类实现
2. ✅ **写点评和思考** - 已通过 comment 功能实现
3. ❌ **AI 深度解读** - **缺失**，需要增强

### 现有功能分析

#### 已实现 ✅
- Timeline 页面：流水账式展示所有内容
- Organize 页面：AI 自动分类视图
- AI 分类：自动生成分类、标签、一句话摘要
- 链接点评：用户手动输入点评和评分
- 剪贴板检测：快速添加链接

#### 功能缺陷 ⚠️
现有 AI 功能只做**浅层处理**：
- 只有简单的分类（技术、生活、娱乐...）
- 只有关键词标签提取
- 只有一句话摘要（不超过50字）

**缺少深度能力**：
- 没有深度解读文章核心观点
- 没有提炼关键洞察
- 没有生成思考引导问题
- 没有 AI 辅助点评功能

---

## 🎯 改进方案

### 核心功能：AI 深度解读 (aiInsight)

为每个收藏的链接提供深度 AI 分析，包括：

#### 1. 核心观点提炼 📝
- 提取文章的 3-5 个核心观点
- 每个观点包含简短描述（1-2 句话）
- 观点按重要性排序

#### 2. 深度洞察 💡
- 分析内容的价值和意义
- 提供启发性的思考角度
- 指出可能的应用场景
- 与其他知识领域的关联

#### 3. 思考引导问题 🤔
- 生成 3-5 个引导性问题
- 帮助用户深入思考
- 激发个人见解
- 辅助写点评

#### 4. AI 辅助点评 ✍️
- 根据 AI 解读生成点评框架
- 提供多角度思考提示
- 智能补全用户思考
- 快速生成初稿供用户编辑

---

## 🏗️ 技术设计

### 1. 数据库结构扩展

#### links 集合新增字段
```javascript
{
  // ... 原有字段

  // AI 深度解读（新增）
  aiInsight: {
    // 核心观点（3-5个）
    keyPoints: [
      {
        title: "观点标题",
        content: "观点详细描述（1-2句话）",
        importance: 1  // 重要性排序 1-5
      }
    ],

    // 深度洞察
    insights: {
      value: "这篇内容的价值是什么",
      inspiration: "可以给我们什么启发",
      application: "可以应用在哪些场景",
      connection: "与哪些知识领域相关"
    },

    // 思考引导问题（3-5个）
    questions: [
      "这个观点对你的工作有什么启发？",
      "你是否遇到过类似的场景？",
      "如果应用这个方法，可能遇到什么挑战？"
    ],

    // AI 生成时间
    generatedAt: Date,

    // AI 模型版本
    modelVersion: "qwen-turbo"
  },

  // AI 辅助生成的点评建议（临时，不保存到数据库）
  // 通过实时调用生成
}
```

### 2. 云函数设计

#### 新增云函数：aiInsight
```
cloudfunctions/aiInsight/
├── index.js          # 主逻辑
├── config.json
└── package.json
```

**功能**：
- 接收：linkId, title, description, url, summary
- 调用通义千问 API 进行深度分析
- 返回结构化的深度解读结果
- 支持缓存机制，避免重复分析

**Prompt 设计**：
```
你是一个内容深度分析专家。请对以下内容进行深度解读：

标题：{title}
描述：{description}
摘要：{summary}

请返回 JSON 格式（不要包含其他内容）：
{
  "keyPoints": [
    {
      "title": "核心观点1",
      "content": "观点详细描述（1-2句话）",
      "importance": 1
    }
  ],
  "insights": {
    "value": "内容价值分析",
    "inspiration": "启发性思考",
    "application": "应用场景",
    "connection": "知识关联"
  },
  "questions": [
    "思考问题1",
    "思考问题2",
    "思考问题3"
  ]
}

要求：
1. keyPoints 提取 3-5 个核心观点
2. insights 每项 50-100 字
3. questions 生成 3-5 个启发性问题
4. 用中文输出，语言精炼专业
```

#### 新增云函数：aiAssistComment
```
cloudfunctions/aiAssistComment/
├── index.js
├── config.json
└── package.json
```

**功能**：
- 接收：linkId, title, aiInsight, userInput（可选）
- 基于 AI 解读生成点评建议
- 支持基于用户部分输入的智能补全

**Prompt 设计**：
```
你是一个点评撰写助手。请根据以下信息帮助用户撰写点评：

文章标题：{title}
AI 解读：{aiInsight}
用户已输入：{userInput}

请生成 3 个不同角度的点评建议（每个 100-150 字）：
1. 从实践应用角度
2. 从个人成长角度
3. 从深度思考角度

返回 JSON 格式：
{
  "suggestions": [
    {
      "angle": "实践应用",
      "content": "点评内容..."
    },
    {
      "angle": "个人成长",
      "content": "点评内容..."
    },
    {
      "angle": "深度思考",
      "content": "点评内容..."
    }
  ]
}
```

### 3. 前端页面改造

#### link-detail 页面增强

**新增 UI 元素**：
1. **AI 解读卡片**
   - 折叠/展开设计
   - 核心观点列表（带序号和重要性标记）
   - 深度洞察（分栏展示：价值、启发、应用、关联）
   - 思考问题（可交互，点击自动填充到点评框）

2. **AI 辅助按钮**
   - 位于点评输入框旁边
   - 点击后弹出 3 个角度的点评建议
   - 用户可选择一个作为初稿，再编辑

**交互流程**：
```
用户进入链接详情页
    ↓
检查是否已有 aiInsight
    ↓
如果没有，显示"生成 AI 解读"按钮
    ↓
用户点击 → 调用 aiInsight 云函数 → 展示结果
    ↓
用户点击思考问题 → 自动添加到点评框
    ↓
用户点击"AI 辅助点评" → 弹出 3 个建议 → 选择一个
    ↓
用户编辑点评 → 保存
```

---

## 📅 实施计划

### Phase 1：核心功能开发 ✅ 已完成
- [x] 创建 develop.md 文档
- [x] 实现 aiInsight 云函数
- [x] 更新 links 数据结构（无模式数据库，直接使用）
- [x] 在 link-detail 页面添加"生成 AI 解读"功能
- [x] 展示 AI 解读结果（核心观点、深度洞察、思考问题）

### Phase 2：AI 辅助点评 ✅ 已完成
- [x] 实现 aiAssistComment 云函数
- [x] 在 link-detail 页面添加"AI 辅助点评"功能
- [x] 实现点评建议选择和编辑（弹窗选择 3 种角度建议）

### Phase 3：优化与增强 ✅ 已完成
- [x] 添加加载状态和错误处理（所有 API 调用都有降级方案）
- [x] 优化 UI 展示效果（渐变色、动画效果）
- [x] 添加 AI 解读缓存机制（云函数自动缓存到数据库）
- [x] 成本控制（降级方案确保免费可用）

### Phase 4：后续规划
- [ ] 主题聚合功能（在 organize 页面）
- [ ] 知识图谱展示
- [ ] 定期回顾和总结
- [ ] 关联内容推荐

---

## 💰 成本控制

### API 调用策略
1. **缓存优先**：已生成的 AI 解读永久缓存，不重复调用
2. **按需生成**：只在用户点击"生成 AI 解读"时调用
3. **每日限制**：单用户每日最多生成 10 次 AI 解读
4. **失败降级**：API 失败时显示友好提示，不影响基础功能

### 预估成本（通义千问）
- 单次 AI 解读：约 2000 tokens（输入 + 输出）
- 单次 AI 辅助点评：约 1500 tokens
- 假设每天 20 个用户，每人生成 5 次：
  - 20 × 5 × 2000 = 200,000 tokens/天
  - 通义千问免费额度：100 万 tokens/月
  - 成本：基本在免费额度内

---

## 🔐 隐私与安全

1. **数据隐私**
   - AI 解读结果仅用户自己可见
   - 不上传完整文章内容，只发送标题、描述、摘要
   - 遵守微信小程序隐私规范

2. **内容安全**
   - AI 返回结果需过滤敏感词
   - 异常结果需人工审核机制
   - 用户可手动删除 AI 生成内容

---

## 📊 效果评估

### 成功指标
1. **用户使用率**
   - AI 解读生成率 > 60%
   - AI 辅助点评使用率 > 40%

2. **内容质量**
   - 用户点评完成率提升 50%
   - 点评平均长度提升 100 字

3. **用户反馈**
   - 收集用户对 AI 解读质量的评分
   - 持续优化 Prompt

---

## 🛠️ 开发日志

### 2026-02-09
- ✅ 创建 develop.md，明确改进方案
- ✅ 实现 aiInsight 云函数（深度解读）
- ✅ 实现 aiAssistComment 云函数（辅助点评）
- ✅ 更新链接详情页 UI，添加 AI 解读展示
- ✅ 添加 AI 辅助点评弹窗功能
- ✅ 实现思考问题点击添加到点评功能
- ✅ 添加完整的加载状态和错误处理
- ✅ 实现降级方案确保无 API Key 也可使用

---

## 📝 待解决问题

1. ❓ 微信文章链接如何获取完整正文？
   - 微信文章有防爬机制
   - 可能需要用户手动复制正文或使用微信开放能力

2. ❓ 短视频内容如何解读？
   - 视频缺少文字内容
   - 可能需要接入视频理解 API 或让用户手动补充描述

3. ❓ AI 解读结果如何验证准确性？
   - 建立人工抽查机制
   - 收集用户反馈优化 Prompt

---

## 🔗 相关文档

- [开发计划](./plan.md) - 项目整体规划
- [README](./README.md) - 项目说明
- [通义千问 API 文档](https://help.aliyun.com/zh/dashscope/developer-reference/api-details)
