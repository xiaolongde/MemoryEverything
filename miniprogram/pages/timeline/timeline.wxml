<!--pages/timeline/timeline.wxml-->
<!-- åŠ¨æ€é¡µ - æ—¶é—´çº¿æµæ°´è´¦ -->

<view class="page-container">
  <!-- é¡¶éƒ¨æœç´¢æ  -->
  <view class="search-bar" bindtap="goToSearch">
    <view class="search-input">
      <image class="search-icon" src="/images/icon-search.png" mode="aspectFit"></image>
      <text class="search-placeholder">æœç´¢</text>
    </view>
  </view>

  <!-- æ—¶é—´çº¿åˆ—è¡¨ -->
  <view class="timeline-list" wx:if="{{items.length > 0}}">
    <view 
      wx:for="{{items}}" 
      wx:key="_id"
      class="timeline-item"
      data-id="{{item._id}}"
      data-type="{{item.itemType}}"
      bindtap="{{item.itemType === 'link' ? 'onLinkTap' : 'onNoteTap'}}"
      bindlongpress="onItemLongPress"
    >
      <!-- é“¾æ¥ç±»å‹ -->
      <block wx:if="{{item.itemType === 'link'}}">
        <view class="item-card link-card">
          <view class="card-header">
            <view class="type-badge link">
              <text>{{item.source === 'wechat_article' ? 'ğŸ“„ å…¬ä¼—å·' : item.source === 'wechat_video' ? 'ğŸ¬ è§†é¢‘' : 'ğŸ”— é“¾æ¥'}}</text>
            </view>
            <text class="time">{{item.displayTime}}</text>
          </view>
          
          <view class="card-body">
            <view class="link-content">
              <text class="title">{{item.title || 'æ— æ ‡é¢˜'}}</text>
              <text class="desc" wx:if="{{item.description}}">{{item.description}}</text>
              <text class="url">{{item.url}}</text>
            </view>
            <image 
              wx:if="{{item.thumbnail}}" 
              class="thumbnail" 
              src="{{item.thumbnail}}" 
              mode="aspectFill"
            ></image>
          </view>

          <!-- ç‚¹è¯„é¢„è§ˆ -->
          <view class="comment-preview" wx:if="{{item.comment && item.comment.content}}">
            <text class="comment-label">æˆ‘çš„ç‚¹è¯„ï¼š</text>
            <text class="comment-text">{{item.comment.content}}</text>
          </view>

          <!-- AI æ ‡ç­¾ï¼ˆå¦‚æœæœ‰ï¼‰ -->
          <view class="tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
          </view>
        </view>
      </block>

      <!-- æ„Ÿæ‚Ÿç±»å‹ -->
      <block wx:if="{{item.itemType === 'note'}}">
        <view class="item-card note-card">
          <view class="card-header">
            <view class="type-badge note">
              <text>ğŸ’­ æ„Ÿæ‚Ÿ</text>
              <text class="mood" wx:if="{{item.mood}}">
                {{item.mood === 'happy' ? 'ğŸ˜Š' : item.mood === 'thinking' ? 'ğŸ¤”' : item.mood === 'sad' ? 'ğŸ˜¢' : item.mood === 'excited' ? 'ğŸ‰' : 'ğŸ˜Œ'}}
              </text>
            </view>
            <text class="time">{{item.displayTime}}</text>
          </view>
          
          <view class="card-body">
            <text class="note-content">{{item.content}}</text>
          </view>

          <!-- å›¾ç‰‡ -->
          <view class="note-images" wx:if="{{item.images && item.images.length > 0}}">
            <image 
              wx:for="{{item.images}}" 
              wx:for-item="img"
              wx:key="*this"
              wx:if="{{index < 3}}"
              class="note-image"
              src="{{img}}" 
              mode="aspectFill"
            ></image>
            <view class="more-images" wx:if="{{item.images.length > 3}}">
              +{{item.images.length - 3}}
            </view>
          </view>

          <!-- æ ‡ç­¾ -->
          <view class="tags" wx:if="{{item.tags && item.tags.length > 0}}">
            <text class="tag" wx:for="{{item.tags}}" wx:for-item="tag" wx:key="*this">{{tag}}</text>
          </view>
        </view>
      </block>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!loading && items.length === 0}}">
    <image src="/images/empty-link.png" mode="aspectFit"></image>
    <text class="empty-title">è¿˜æ²¡æœ‰ä»»ä½•è®°å½•</text>
    <text class="empty-hint">ç‚¹å‡»å³ä¸‹è§’æŒ‰é’®å¼€å§‹è®°å½•</text>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading && !refreshing}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- æ²¡æœ‰æ›´å¤š -->
  <view class="no-more" wx:if="{{!hasMore && items.length > 0}}">
    <text>æ²¡æœ‰æ›´å¤šäº†</text>
  </view>
</view>

<!-- é®ç½©å±‚ -->
<view class="mask" wx:if="{{showAddMenu}}" bindtap="hideAddMenu"></view>

<!-- æ‚¬æµ®æ·»åŠ æŒ‰é’® -->
<view class="fab-container">
  <!-- å±•å¼€çš„èœå• -->
  <view class="fab-menu {{showAddMenu ? 'show' : ''}}">
    <view class="fab-menu-item" bindtap="goToAddLink">
      <text class="fab-menu-icon">ğŸ”—</text>
      <text class="fab-menu-text">æ·»åŠ é“¾æ¥</text>
    </view>
    <view class="fab-menu-item" bindtap="goToAddNote">
      <text class="fab-menu-icon">ğŸ’­</text>
      <text class="fab-menu-text">è®°å½•æ„Ÿæ‚Ÿ</text>
    </view>
  </view>
  
  <!-- ä¸»æŒ‰é’® -->
  <view class="fab-btn {{showAddMenu ? 'active' : ''}}" bindtap="toggleAddMenu">
    <text class="fab-icon">+</text>
  </view>
</view>
