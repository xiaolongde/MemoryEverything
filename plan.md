# MemoryEverything - 开发计划

> 个人知识管理小程序：链接收藏 + 感悟记录 + AI 智能分类

## 📋 项目概述

### 核心功能
| 功能 | 描述 |
|------|------|
| 链接收藏 | 保存分享的链接，自动抓取标题/描述/缩略图 |
| 智能分类 | AI 自动分析内容并分类、提取标签 |
| 链接点评 | 对收藏的链接添加个人点评/笔记 |
| 感悟记录 | 记录日常感悟短文，支持图片 |
| 全文搜索 | 搜索链接和感悟内容 |
| 多端同步 | 云端存储，多设备数据同步 |
| 数据备份 | 支持导出备份（后期实现） |

### 链接来源
- 微信公众号文章
- 微信短视频
- 外部 App 链接

---

## 🏗️ 技术架构

```
┌─────────────────────────────────────────────────┐
│                 微信小程序前端                    │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐        │
│  │ 链接收藏  │ │ 感悟记录  │ │ 分类浏览  │        │
│  └──────────┘ └──────────┘ └──────────┘        │
│              本地缓存 (Storage)                  │
└───────────────────┬─────────────────────────────┘
                    │
┌───────────────────▼─────────────────────────────┐
│               微信云开发                         │
│  ┌──────────────────────────────────────────┐  │
│  │ 云函数                                    │  │
│  │ • parseLink   - 链接解析                  │  │
│  │ • aiClassify  - AI 智能分类               │  │
│  │ • syncData    - 数据同步                  │  │
│  │ • exportData  - 数据导出                  │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │ 云数据库 (MongoDB)                        │  │
│  │ • links / notes / categories / tags      │  │
│  └──────────────────────────────────────────┘  │
│  ┌──────────────────────────────────────────┐  │
│  │ 云存储                                    │  │
│  │ • 图片存储 / 备份文件                     │  │
│  └──────────────────────────────────────────┘  │
└─────────────────────────────────────────────────┘
                    │
                    ▼
        ┌─────────────────────┐
        │   AI API (分类)      │
        │ 通义千问 / 文心一言   │
        └─────────────────────┘
```

---

## 📊 数据库设计

### links 集合（链接）
```javascript
{
  _id: "xxx",
  _openid: "用户标识",
  url: "https://mp.weixin.qq.com/...",
  title: "自动抓取的标题",
  description: "自动抓取的描述",
  thumbnail: "缩略图URL",
  source: "wechat_article",   // wechat_article | wechat_video | external
  category: "技术",           // AI 自动分类
  tags: ["前端", "React"],    // AI 提取的标签
  summary: "AI生成的一句话摘要",
  
  // 用户点评
  comment: {
    content: "用户的点评内容...",
    rating: 5,                // 可选：1-5星评分
    updateTime: Date          // 点评更新时间
  },
  
  isRead: false,
  isFavorite: false,
  createTime: Date,
  updateTime: Date
}
```

### notes 集合（感悟）
```javascript
{
  _id: "xxx",
  _openid: "用户标识",
  content: "今天的感悟...",
  images: ["cloud://xxx.png"],
  mood: "happy",              // 可选：心情标记
  tags: ["生活", "思考"],
  createTime: Date,
  updateTime: Date
}
```

### categories 集合（分类）
```javascript
{
  _id: "xxx",
  _openid: "用户标识",
  name: "技术",
  icon: "code",
  color: "#1890ff",
  count: 0,                   // 该分类下的链接数
  order: 1
}
```

### 索引设计
- links: `_openid + createTime` (复合索引)
- links: `_openid + category` (复合索引)
- links: `title` (全文索引)
- notes: `_openid + createTime` (复合索引)

---

## 🎨 页面结构

```
TabBar (4个标签)
│
├── 📥 首页 (收藏)
│   ├── 搜索栏
│   ├── 分类快捷筛选
│   ├── 链接列表（瀑布流/列表切换）
│   │   └── 链接卡片：缩略图 + 标题 + 来源 + 分类标签 + 点评预览
│   └── 悬浮添加按钮
│
├── 💭 感悟
│   ├── 时间线展示
│   ├── 感悟卡片：内容 + 图片 + 时间 + 标签
│   └── 新建感悟按钮
│
├── 📁 分类
│   ├── 分类网格/列表
│   ├── 每个分类显示数量
│   └── 标签云展示
│
└── 👤 我的
    ├── 用户头像 + 昵称
    ├── 数据统计（链接数/感悟数/分类数）
    ├── 备份与恢复
    ├── 设置
    │   ├── 默认分类
    │   ├── AI 分类开关
    │   └── 缓存管理
    └── 关于
```

### 其他页面
- 链接详情页
  - 显示链接完整信息
  - 点评输入区域（文字 + 评分）
  - 点评历史记录
- 感悟详情/编辑页
- 分类详情页（该分类下所有链接）
- 搜索结果页
- 添加链接页（手动输入）

---

## 🔄 核心流程

### 1. 添加链接流程
```
用户从微信/其他App分享链接到小程序
              ↓
        接收分享内容
              ↓
    显示加载中，调用云函数
              ↓
   云函数 parseLink 解析链接
   ├── 抓取网页 title
   ├── 抓取 meta description
   ├── 抓取 og:image 缩略图
   └── 识别来源类型
              ↓
   云函数 aiClassify 调用 AI
   ├── 分析内容
   ├── 匹配/生成分类
   ├── 提取标签
   └── 生成一句话摘要
              ↓
       保存到云数据库
              ↓
       同步到本地缓存
              ↓
     显示成功，可手动调整分类
```

### 2. AI 分类 Prompt
```
你是一个内容分类助手。请分析以下内容，返回 JSON 格式结果。

内容信息：
- 标题：{title}
- 描述：{description}  
- URL：{url}

请返回以下 JSON 格式（不要包含其他内容）：
{
  "category": "最匹配的分类",
  "tags": ["标签1", "标签2", "标签3"],
  "summary": "一句话摘要（不超过50字）"
}

分类候选：技术、生活、娱乐、工作、学习、阅读、视频、音乐、购物、美食、旅行、健康、财经、其他
```

### 3. 搜索流程
```
用户输入关键词
      ↓
本地缓存快速匹配（标题）
      ↓
显示本地结果 + Loading
      ↓
云端全文搜索
      ↓
合并去重，更新结果
```

---

## 📅 开发计划

### Phase 1：基础框架（第1周）
- [ ] 初始化小程序项目
- [ ] 搭建页面结构和路由
- [ ] 实现 TabBar 导航
- [ ] 设计并实现 UI 组件库
  - [ ] 链接卡片组件
  - [ ] 感悟卡片组件
  - [ ] 分类标签组件
- [ ] 本地存储封装
- [ ] 手动添加链接功能

### Phase 2：云开发接入（第2周）
- [ ] 初始化云开发环境
- [ ] 创建云数据库集合和索引
- [ ] 实现用户登录（静默登录获取 openid）
- [ ] 云函数：parseLink（链接解析）
  - [ ] 网页抓取
  - [ ] 微信文章特殊处理
- [ ] 数据增删改查 API
- [ ] 本地缓存与云端同步机制

### Phase 3：AI 分类 + 搜索（第3周）
- [ ] 接入 AI API（通义千问/文心一言）
- [ ] 云函数：aiClassify（智能分类）
- [ ] 分类管理功能
- [ ] 标签管理功能
- [ ] 搜索功能实现
  - [ ] 本地搜索
  - [ ] 云端全文搜索
- [ ] 搜索历史记录

### Phase 4：感悟功能 + UI 优化（第4周）
- [ ] 感悟列表页面
- [ ] 新建/编辑感悟
- [ ] 图片上传到云存储
- [ ] 时间线展示优化
- [ ] 整体 UI/UX 优化
- [ ] 加载状态和空状态
- [ ] 下拉刷新和上拉加载

### Phase 5：完善 + 上线（第5周）
- [ ] 数据统计功能
- [ ] 备份与恢复功能（导出 JSON）
- [ ] 性能优化
- [ ] 异常处理完善
- [ ] 测试和 Bug 修复
- [ ] 准备上线材料
- [ ] 提交审核

---

## 🛠️ 技术选型

| 类型 | 选择 | 说明 |
|------|------|------|
| 小程序框架 | 原生微信小程序 | 性能最优，官方支持好 |
| UI 组件库 | Vant Weapp | 轻量、美观、文档完善 |
| 状态管理 | MobX-miniprogram | 简单易用 |
| 云开发 | 微信云开发 | 免服务器，一体化方案 |
| 数据库 | 云开发数据库(MongoDB) | 自带，无需额外配置 |
| AI 服务 | 通义千问 API | 国内可用，性价比高 |
| 网页解析 | cheerio (云函数) | 轻量 HTML 解析库 |

---

## 📁 项目结构

```
MemoryEverything/
├── cloudfunctions/           # 云函数
│   ├── parseLink/            # 链接解析
│   ├── aiClassify/           # AI 分类
│   ├── syncData/             # 数据同步
│   └── exportData/           # 数据导出
│
├── miniprogram/              # 小程序主体
│   ├── pages/                # 页面
│   │   ├── index/            # 首页（链接列表）
│   │   ├── notes/            # 感悟页
│   │   ├── category/         # 分类页
│   │   ├── mine/             # 我的页
│   │   ├── link-detail/      # 链接详情
│   │   ├── note-edit/        # 感悟编辑
│   │   ├── search/           # 搜索页
│   │   └── add-link/         # 添加链接
│   │
│   ├── components/           # 组件
│   │   ├── link-card/        # 链接卡片
│   │   ├── note-card/        # 感悟卡片
│   │   ├── comment-card/     # 点评卡片
│   │   ├── rating-star/      # 评分星星组件
│   │   ├── category-tag/     # 分类标签
│   │   ├── search-bar/       # 搜索栏
│   │   └── empty-state/      # 空状态
│   │
│   ├── services/             # 服务层
│   │   ├── link.js           # 链接相关 API
│   │   ├── note.js           # 感悟相关 API
│   │   ├── category.js       # 分类相关 API
│   │   └── user.js           # 用户相关 API
│   │
│   ├── utils/                # 工具函数
│   │   ├── storage.js        # 本地存储
│   │   ├── request.js        # 云函数调用封装
│   │   ├── format.js         # 格式化工具
│   │   └── constants.js      # 常量定义
│   │
│   ├── store/                # 状态管理
│   │   └── index.js
│   │
│   ├── styles/               # 全局样式
│   │   └── common.wxss
│   │
│   ├── app.js
│   ├── app.json
│   └── app.wxss
│
├── project.config.json
└── README.md
```

---

## ⚠️ 风险与注意事项

1. **微信审核**
   - 需要准备好隐私协议
   - 确保内容合规

2. **AI API 成本**
   - 初期可设置每日调用限制
   - 考虑缓存相似内容的分类结果

3. **链接解析限制**
   - 部分网站可能有反爬机制
   - 需要做好降级处理（用户手动输入）

4. **云开发配额**
   - 关注免费额度使用情况
   - 做好本地缓存减少云端调用

---

## 📝 待确认事项

- [ ] AI 服务最终选择（通义千问 / 文心一言 / 其他）
- [ ] 预设分类列表最终确定
- [ ] 小程序名称和 Logo 设计
- [ ] 是否需要分享功能（分享感悟到朋友圈）
