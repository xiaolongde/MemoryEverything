# AI 深度解读功能 - 部署指南

> 本指南帮助你快速部署 AI 深度解读和辅助点评功能

## 📦 已完成的开发内容

### 1. 新增云函数
- ✅ `cloudfunctions/aiInsight/` - AI 深度解读
- ✅ `cloudfunctions/aiAssistComment/` - AI 辅助点评

### 2. 增强的页面
- ✅ `miniprogram/pages/link-detail/` - 链接详情页（新增 AI 解读和辅助点评功能）

### 3. 新增功能
- AI 深度解读：核心观点提炼、深度洞察、思考引导问题
- AI 辅助点评：3 种角度的点评建议（实践应用、个人成长、深度思考）
- 思考问题点击快速添加到点评
- 完整的降级方案（无 API Key 也可使用）

---

## 🚀 部署步骤

### 步骤 1：配置通义千问 API Key（可选）

如果你想使用完整的 AI 功能，需要配置通义千问 API Key：

1. **申请 API Key**
   - 访问 [通义千问 DashScope](https://dashscope.aliyuncs.com/)
   - 注册并登录账号
   - 在控制台获取 API Key

2. **配置 aiInsight 云函数**

   编辑 `cloudfunctions/aiInsight/index.js` 第 13 行：
   ```javascript
   QWEN_API_KEY: 'your-api-key-here', // 替换为你的 API Key
   ```
   改为：
   ```javascript
   QWEN_API_KEY: 'sk-xxxxxxxxxxxxxxxxxxxxxxxx', // 你的实际 API Key
   ```

3. **配置 aiAssistComment 云函数**

   编辑 `cloudfunctions/aiAssistComment/index.js` 第 13 行：
   ```javascript
   QWEN_API_KEY: 'your-api-key-here', // 替换为你的 API Key
   ```
   改为：
   ```javascript
   QWEN_API_KEY: 'sk-xxxxxxxxxxxxxxxxxxxxxxxx', // 你的实际 API Key
   ```

**注意**：如果不配置 API Key，系统会自动使用降级方案，仍然可以正常使用（但 AI 能力会受限）。

---

### 步骤 2：上传云函数

使用微信开发者工具上传云函数：

1. **上传 aiInsight 云函数**
   - 右键点击 `cloudfunctions/aiInsight`
   - 选择「上传并部署：云端安装依赖」
   - 等待部署完成（约 1-2 分钟）

2. **上传 aiAssistComment 云函数**
   - 右键点击 `cloudfunctions/aiAssistComment`
   - 选择「上传并部署：云端安装依赖」
   - 等待部署完成（约 1-2 分钟）

---

### 步骤 3：测试功能

1. **打开小程序**
   - 在微信开发者工具中编译运行小程序
   - 或者在真机上预览

2. **测试 AI 深度解读**
   - 进入任意一个已保存的链接详情页
   - 点击「✨ 生成解读」按钮
   - 等待 AI 生成解读结果（约 3-10 秒）
   - 查看核心观点、深度洞察、思考问题

3. **测试 AI 辅助点评**
   - 在链接详情页，生成 AI 解读后
   - 点击「✨ AI 辅助」按钮
   - 查看 3 种角度的点评建议
   - 点击任一建议，自动填充到点评框

4. **测试思考问题**
   - 点击任一思考问题
   - 问题会自动添加到点评框
   - 可以基于问题撰写自己的思考

---

## 💡 功能使用说明

### AI 深度解读

**触发方式**：
- 进入链接详情页
- 点击「🤖 AI 深度解读」区域的「✨ 生成解读」按钮

**生成内容**：
1. **📝 核心观点**（3-5 个）
   - 提取文章最重要的观点
   - 每个观点有标题和详细描述
   - 按重要性排序

2. **💡 深度洞察**（4 个维度）
   - 核心价值：内容的价值所在
   - 启发思考：可以带来什么启发
   - 应用场景：如何应用到实践
   - 知识关联：与哪些知识相关

3. **🤔 思考问题**（3-5 个）
   - 引导性问题帮助深入思考
   - 点击问题可快速添加到点评

**缓存机制**：
- 生成的 AI 解读会自动保存到数据库
- 下次查看同一链接时，直接展示缓存结果
- 无需重复调用 API，节省成本

---

### AI 辅助点评

**触发方式**：
- 在链接详情页生成 AI 解读后
- 点击「我的点评」区域的「✨ AI 辅助」按钮

**生成内容**：
- 3 种角度的点评建议：
  1. **🎯 实践应用**：如何应用到工作/生活
  2. **🌱 个人成长**：对个人成长的启发
  3. **🧠 深度思考**：批判性思考和多角度分析

**使用方式**：
- 点击任一建议卡片
- 建议内容会自动填充到点评框
- 你可以在此基础上继续编辑

---

## 🎯 使用技巧

### 1. 善用思考问题
- 点击「🤔 思考问题」中的任一问题
- 问题会自动添加到点评框
- 基于问题撰写你的思考，更有条理

### 2. 组合使用 AI 功能
建议的使用流程：
1. 先生成「AI 深度解读」
2. 阅读核心观点和深度洞察
3. 点击感兴趣的思考问题添加到点评
4. 使用「AI 辅助点评」获取建议
5. 选择一个角度的建议作为初稿
6. 结合自己的思考，编辑完善点评

### 3. 降级方案说明
如果没有配置 API Key，系统会使用降级方案：
- 仍然可以生成基础的解读和建议
- 但内容会更通用，缺少个性化分析
- 建议配置 API Key 获得最佳体验

---

## ⚠️ 注意事项

### 1. API 成本控制
- 通义千问有免费额度（100 万 tokens/月）
- 单次 AI 解读约消耗 2000 tokens
- 单次 AI 辅助点评约消耗 1500 tokens
- 建议每天生成不超过 20 次，可在免费额度内

### 2. 生成时间
- AI 解读生成时间：3-10 秒
- AI 辅助点评生成时间：3-8 秒
- 如果网络不好可能更长，请耐心等待

### 3. 内容质量
- AI 解读质量取决于链接的标题、描述、摘要
- 如果链接信息不完整，AI 解读可能不够准确
- 建议在添加链接时，确保抓取到完整信息

### 4. 数据库索引（可选优化）
如果链接数量较多，建议在云开发控制台添加索引：
- 集合：`links`
- 索引字段：`_openid + aiInsight` （升序）

---

## 🔧 故障排查

### 问题 1：点击「生成解读」没有反应
**可能原因**：
- 云函数未部署或部署失败
- 网络连接问题

**解决方法**：
1. 检查云函数是否上传成功
2. 在云开发控制台查看云函数日志
3. 检查手机网络连接

### 问题 2：生成的内容质量不好
**可能原因**：
- 链接信息不完整
- 使用了降级方案

**解决方法**：
1. 检查链接是否有标题、描述、摘要
2. 配置通义千问 API Key
3. 尝试重新生成

### 问题 3：调用 API 失败
**可能原因**：
- API Key 配置错误
- API 额度用完
- 网络问题

**解决方法**：
1. 检查 API Key 是否正确
2. 在通义千问控制台查看额度使用情况
3. 查看云函数日志了解具体错误

---

## 📊 后续优化方向

### 短期优化（1-2 周）
- [ ] 添加每日调用次数限制
- [ ] 优化 Prompt 提升 AI 解读质量
- [ ] 添加手动刷新 AI 解读功能
- [ ] 支持编辑和删除 AI 解读

### 中期规划（1-2 月）
- [ ] 主题聚合：AI 自动发现多个内容的主题关联
- [ ] 知识图谱：展示内容之间的关联关系
- [ ] 定期回顾：AI 定期总结收藏的内容趋势
- [ ] 关联推荐：基于当前内容推荐相关已收藏内容

### 长期愿景
- [ ] 个人知识库 RAG 问答
- [ ] 导出 Markdown 笔记
- [ ] 分享精选内容到朋友圈
- [ ] 协作功能（与好友分享知识）

---

## 🆘 需要帮助？

如果遇到问题，可以：
1. 查看云函数日志：云开发控制台 -> 云函数 -> 日志
2. 查看小程序控制台错误信息
3. 参考 [develop.md](./develop.md) 了解详细设计
4. 查看 [README.md](./README.md) 了解项目整体情况

---

**祝使用愉快！🎉**
